
<!DOCTYPE html>
<html>
    <head>
        <title>学术会议管理平台</title>
        <meta charset="utf-8"> 
        <link rel="stylesheet" href="../libs/css/bootstrap.min.css">
        <script src="../libs/js/jquery.js"></script>
        <script src="../libs/js/bootstrap.js"></script>
        <script src="../libs/js/jquery-form.js"></script>
    </head>
    <body onLoad="uname1()">
        <!--Navigation导航栏部分
        <div>
            <nav class="navbar navbar-default" role="navigation">
                <br/> 
                <div class="container-fluid">
                    <div class="navbar-header" style="margin-left: 18% ">
                        <a class="navbar-brand" style="font-weight: bold;font-size: 25px" href="#"><font color="white">学术会议管理平台</font></a>
                    </div>
                    <div class="hidden-sm" style="margin-right: 10%">
                        <form class="navbar-form navbar-left" style="margin-left: 10%">
                                <div class="form-group">
                                    <select class="form-control">
                                            <option>按时间</option>
                                            <option>按地区</option>
                                            <option>主办方</option>
                                            <option>按名称</option>
                                        </select>  
                                    <input type="text" class="form-control" placeholder="查找会议">
                                    <button type="submit" class="btn btn-default">查找</button>
                                </div>
                        </form>
                        <form class="navbar-form navbar-left" style="margin-left:10%">
                            <div class="input-group">
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">按时间<span class="caret"></span></button>
                                        <ul class="dropdown-menu">
                                            <li>
                                                <a href="#">按地区</a>
                                            </li>
                                            <li class="divider"></li>
                                            <li>
                                                <a href="#">按主办方</a>
                                            </li>
                                            <li class="divider"></li>
                                            <li>
                                                <a href="#">按名称</a>
                                            </li>
                                        </ul>
                                </div>
                                <input type="text" class="form-control" placeholder="查找会议">
                                <div class="input-group-btn">
                                    <button class="btn btn-default" type="button">查找</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div>
                        <div id="navbar">
                                <ul class="nav navbar-nav" style="margin-left: 15%">
                                        <li class="dropdown">
                                                <a href="#" id="company_name" class="dropdown-toggle" data-toggle="dropdown"> 
                                                </a>
                                                <ul class="dropdown-menu" role="menu" aria-labelledby="drop">
                                                  <li><a id="LogIn" href="#">登录</a></li>
                                                  <li class="divider"></li>
                                                  <li><a id="SignIn" href="#">注册</a></li>
                                                  <li class="divider"></li>
                                                  <li><a id="LogOut"href="#">登出</a></li>
                                                </ul>
                                        </li>
                                </ul>
                        </div>
                        
                    </div>
                </div>  
                <br/>   
            </nav>
        </div>
        Navigation导航栏结束-->
        <div id='topnav'>
            <!--Navigation导航栏部分-->
            <div>
                <nav class="navbar navbar-default" role="navigation">
                    <br/> 
                    <div class="container-fluid">
                        <div class="navbar-header" style="margin-left: 15%">
                            <a class="navbar-brand" href="#">学术会议管理平台</a>
                        </div>
                        <div class="hidden-sm hidden-xs" style="margin-right: 10%">
                            <form class="navbar-form navbar-left" style="margin-left: 10%">
                                    <div class="form-group">
                                        <select class="form-control">
                                                <option>按时间</option>
                                                <option>按地区</option>
                                                <option>主办方</option>
                                                <option>按名称</option>
                                            </select>  
                                        <input type="text" class="form-control" placeholder="查找会议">
                                        <button type="submit" class="btn btn-default">查找</button>
                                    </div>
                            </form>
                        </div>
                        <div class="navbar-form navbar-left">
                            <button class="btn btn-default" onclick="createMeeting()">创建会议</button>
                        </div>
                        <div>
                            <div id="navbar">
                                <ul class="nav navbar-nav" style="margin-left: 10%">
                                    <li class="dropdown">
                                        <a href="#" id="company_name" class="dropdown-toggle" data-toggle="dropdown"> 
                                            <span class="caret"></span>
                                        </a>
                                        <ul class="dropdown-menu" role="menu" aria-labelledby="drop">
                                            <li><a id="LogIn" href="#" onclick="userLogin()">登录</a></li>
                                            <li class="divider"></li>
                                            <li><a id="SignIn" href="#" onclick="userRegister()">注册</a></li>
                                            <li class="divider"></li>
                                            <li><a id="LogOut"href="#" onclick="logout()">登出</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </div> 
                        </div>
                    </div>  
                    <br/>   
                </nav>
            </div>
            <!--Navigation导航栏结束-->
            <!--注册部分-->
            <div class="modal fade" id="userRegister" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content" style="margin-top:40%">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">注册</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form-horizontal col-md-offset-0" id="login_form">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="username1" class="control-label">昵称：</label>
                                        <input class="form-control required" type="text" placeholder="Username" id="username" name="username" autofocus maxlength="20"/>
                                    </div>
                                    <div class="form-group">
                                        <label for="useremail" class="control-label">邮箱：</label>
                                        <input class="form-control required" type="email" placeholder="Email" id="useremail" name="useremail" autofocus maxlength="20"/>
                                    </div>
                                    <div class="form-group">
                                        <label for="idnumber" class="control-label">身份证号：</label>
                                        <input class="form-control required" type="text" placeholder="Idnumber" id="idnumber" name="idnumber" autofocus maxlength="20"/>
                                    </div>
                                    <div class="form-group">
                                        <label for="password1" class="control-label">密码：</label>
                                        <input class="form-control required" type="password" placeholder="Password" id="password1" name="password" autofocus maxlength="20"/>
                                    </div>
                                    <div class="form-group">
                                        <label for="repassword" class="control-label">确认密码：</label>
                                        <input class="form-control required" type="password" placeholder="Confirm Password" id="repassword" name="repassword" autofocus maxlength="20"/>
                                    </div>
                                    <div class="form-group" >
                                        <font color="#999999">单位用户注册？</font><a href="../institution/institution-register.html" color="#CCCC00">前往注册</a>
                                    </div>
                                    <div class="form-group col-md-offset-9">
                                        <button id='btn' type="submit" class="btn btn-primary" name="submit" onclick="doPostRegister()">注册</button>
                                    </div>
                                    </div>
                                </div>
                            </div>
                        <div class="modal-footer"></div>
                    </div>
                </div>
            </div>
            <!--注册部分结束-->
            <!--用户登录部分-->
            <div class="modal fade" id="userLogin" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content" style="margin-top:40%">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">登录</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form-horizontal col-md-offset-0" id="login_form">
                                <div class="col-md-12">
                                    <div class="btn-group center" id="option" data-toggle="buttons">
                                        <label class="btn btn-default">
                                            <input type="radio" class="toggle" value="user_option">个人用户登录
                                        </label>
                                        <label class="btn btn-default">
                                            <input type="radio" class="toggle" value="institution_option">单位用户登录
                                        </label>
                                    </div>
                                    <br>
                                    <br>
                                    <div class="form-group">
                                        <label class="control-label">邮箱/用户名</label>
                                        <input class="form-control required" type="text" placeholder="Email/Username" id="email_username" name="email" autofocus maxlength="50"/>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label">密码</label>
                                        <input class="form-control required" type="password" placeholder="Password" id="password" name="password" maxlength="20"/>
                                    </div>
                                    
                                    <div class="form-group" >
                                    </div>
                                        <div class="form-group col-md-offset-9">
                                            <button id='btn' type="submit" class="btn btn-success" name="submit" onclick="doPostLogin()">登录</button>
                                        </div>
                                    </div> 
                                </div>
                            </div>
                        <div class="modal-footer"></div>
                    </div>
                </div>
            </div>
            <!--用户登录部分结束-->
        </div>
        <br><br>
        <!--创建会议页面-->
        <div class="container bg-warning">
            <h2>发布新的会议</h2>
            <br><br>
            <!--<form class="form-horizonal" id="aaa">-->
            <form class="form-horizonal" enctype="multipart/form-data" method="post" action="http://154.8.211.55:8081/meeting/create" id="aaa">
                <div class="panel panel-success">
                    <div class="panel-heading">
                        <h3 class="panel-title">会议基本信息</h3>
                    </div><br>
                    <div class="panel-body">
                        <div class="form-group">
                            <label for="title" class="col-sm-2 control-label text-right"><font color="red">*</font>会议名称</label>
                                <div class="input-group col-sm-8" style="margin-left: 18%">
                                    <input type="text" class="form-control" id="title" name="title" placeholder="请输入会议名称" required="required">
                                </div>
                        </div><br>
                        <div class="form-group">
                            <label for="introduction" class="col-sm-2 control-label text-right">会议简介</label>
                                <div class="input-group col-sm-8" style="margin-left: 18%">
                                    <textarea class="form-control" id="introduction" name="introduction" rows="3"></textarea>
                                </div>
                        </div><br>
                        <div class="form-group">
                            <label for="address" class="col-sm-2 control-label text-right"><font color="red">*</font>会议所在地</label>
                                <div class="input-group col-sm-8" style="margin-left: 18%">
                                    <input type="text" class="form-control" id="address" name="address" placeholder="请输入会议所在地" required="required">
                                </div>
                        </div><br>
                        <div class="form-group">
                            <label for="date" class="col-sm-2 control-label text-right"><font color="red">*</font>会议时间</label>
                                <div class="input-group col-sm-5" style="margin-left: 18%">
                                    <input type="date" class="form-control " id="startdate" name="startdate" placeholder="请输入会议开始日期" required="required">
                                    <span class="input-group-addon">至</span>
                                    <input type="date" class="form-control " id="enddate" name="enddate" placeholder="请输入会议截止日期" required="required">
                                </div>
                        </div><br>
                        <div class="form-group">
                            <label for="schedule" class="col-sm-2 control-label text-right">会议日程</label>
                            <div class="input-group col-sm-8" style="margin-left: 18%">
                                <textarea class="form-control" id="schedule" name="schedule" rows="3"></textarea>
                            </div>

                       </div><br><br>
                    </div>
                </div>
                <br>
                <div class="panel panel-success">
                    <div class="panel-heading">
                        <h3 class="panel-title">征文信息</h3>
                    </div><br>
                    <div class="panel-body">
                        <div class="form-group">
                            <label for="paperinfo" class="col-sm-2 control-label text-right">征稿说明</label>
                                <div class="input-group col-sm-8" style="margin-left: 18%">
                                    <textarea class="form-control" id="paperinfo" name="paperinfo" rows="3"></textarea>
                                </div>
                        </div><br>
                        <div class="form-group">
                                <label for="paperinfo" class="col-sm-2 control-label text-right">论文模板</label>
                                <div id='inputfilediv' class="input-group col-sm-8" style="margin-left: 18%">
                                    <!--<textarea class="form-control" id="paperinfo" name="paperinfo" rows="3"></textarea>-->
                                    <input type="file" id="inputfile" name="file" >
                                </div>
                            </div><br>
                        <div class="form-group">
                                <label for="postdate" class="col-sm-2 control-label text-right">征稿时间</label>

                                <div class="input-group col-sm-5" style="margin-left: 18%">
                                    <input type="date" class="form-control " id="poststartdate" name="poststartdate" placeholder="请输入投稿开始日期">
                                    <span class="input-group-addon">至</span>
                                    <input type="date" class="form-control " id="postenddate" name="postenddate" placeholder="请输入投稿截止日期">
                                </div>

                        </div><br>
                        <div class="form-group">
                                <label for="informdate" class="col-sm-2 control-label text-right">录用通知日期</label>
                                    <div class="input-group col-sm-3" style="margin-left: 18%">
                                        <input type="date" class="form-control" id="informdate" name="informdate" placeholder="请输入录用通知日期">
                                    </div>
                            </div><br>
                    </div>
                </div>
                <br>
                <div class="panel panel-success">
                    <div class="panel-heading">
                        <h3 class="panel-title">会议注册</h3>
                    </div><br>
                    <div class="panel-body">
                            <div class="form-group">
                                    <label for="registdate" class="col-sm-2 control-label text-right"><font color="red">*</font>注册日期</label>
                                    <div class="input-group col-sm-5" style="margin-left: 18%">
                                        <input type="date" class="form-control " id="registstartdate" name="registstartdate" placeholder="请输入注册开始日期" required="required">
                                        <span class="input-group-addon">至</span>
                                        <input type="date" class="form-control " id="registenddate" name="registenddate" placeholder="请输入注册截止日期" required="required">
                                    </div>
                            </div><br>
                            <div class="form-group">
                                <label for="registrationfee" class="col-sm-2 control-label text-right"><font color="red">*</font>注册费用</label>
                                    <div class="input-group col-sm-2" style="margin-left: 18%">
                                        <input type="text" class="form-control" id="registrationfee" name="registrationfee" placeholder="请输入注册费用" required="required">
                                    </div>
                            </div><br>
                    </div>
                </div>
                <br>
                <div class="panel panel-success">
                    <div class="panel-heading">
                        <h3 class="panel-title">关于我们</h3>
                    </div><br>
                    <div class="panel-body">
                        <div class="form-group">
                            <label for="company" class="col-sm-2 control-label text-right">组织机构</label>
                            <!--<div id="company" class="col-sm-10"></div>-->
                            <div class="input-group col-sm-3" style="margin-left: 18%">
                                <input type="text" class="form-control" id="company" name="institution_name" placeholder="" readonly="readonly">
                            </div>
                        </div><br><br>
                        <div class="form-group">
                            <label for="contactperson" class="col-sm-2 control-label text-right">负责人</label>
                                <div class="input-group col-sm-3" style="margin-left: 18%">
                                    <input type="text" class="form-control" id="contactperson" name="contactperson" placeholder="">
                                </div>
                        </div><br>
                        <div class="form-group">
                            <label for="phone" class="col-sm-2 control-label text-right"><font color="red">*</font>电话</label>
                            <div class="input-group col-sm-3" style="margin-left: 18%">
                                <input type="text" class="form-control" id="phone" name="phone" placeholder="" required="required">
                            </div>
                        </div><br>
                        <div class="form-group">
                            <label for="email" class="col-sm-2 control-label text-right">邮箱</label>
                            <div class="input-group col-sm-3" style="margin-left: 18%">
                                <input type="text" class="form-control" id="email" name="email" placeholder="">
                            </div>
                        </div><br>
                        <div class="form-group">
                                <label for="traffic" class="col-sm-2 control-label text-right">住宿交通</label>
                                    <div class="input-group col-sm-8" style="margin-left: 18%">
                                        <textarea class="form-control" id="traffic" name="traffic" rows="3"></textarea>
                                    </div>
                            </div><br><br>
                    </div>

                </div>
                <button class="btn btn-success btn-lg" type="submit" onclick="upevi()" >修改会议</button>
                <br><br><br><br><br><br>
            </form>
        </div>
        <!--创建会议页面结束-->
    </body>
    <script>
        var url="http://154.8.211.55:8081";
        
         /*$.ajaxSettings.async=false;
                    //url=url+"/personal_user";
                    $.get(url+"/personal_user/info?uid="+userid,function(data,status){
                        c=data['username'];
                    });
                    return c;*/     
        function uname1()
		{
            //alert("uname1"+document.cookie);
			var a=checkCompany();
            var b=checkName();
            var meetingid = location.search.split('=')[1];
            //docment.getElementById("company").setAttribute('placeholder',a);
            document.getElementById("company").setAttribute("value",a);
            $("#company_name").append(b);
            doget(meetingid);
            //var b=checkCompany(); 
			//$("#company").append(b);
        }
        
        function doget(meetingid)
        {
            $.get(url+'/meeting/info?meeting_id='+meetingid, function(data){
                $('#title').attr('value',data.title);
                $('#introduction').text(data.introduction);
                $('#paperinfo').text(data.paperInfo);
                $('#schedule').text(data.schedule);
                $('#registrationfee').attr('value',data.registrationFee);
                $('#traffic').text(data.accommodationAndTraffic);
                var startdate = data.startDate;
                var poststartdate = data.postStartDate;
                var postenddate = data.postEndDate;
                var informdate = data.informDate;
                var registstartdate=data.registStartDate;
                var registrationdeadline = data.registrationDeadline;
                var enddate = data.endDate;
                if(data.email!=null)
                    $('#email').attr('value',data.email);
                if(data.contactPerson!=null)
                    $('#contactperson').attr('value',data.contactPerson);
                if(data.phone!=null)
                    $('#phone').attr('value',data.phone);
                if(data.address!=null)
                    $('#address').attr('value',data.address);
                if(startdate!=null)
                    $('#startdate').attr('value',startdate);
                if(poststartdate!=null)
                    $('#poststartdate').attr('value',poststartdate);
                if(postenddate!=null)
                    $('#postenddate').attr('value',postenddate);
                if(informdate!=null)
                    $('#informdate').attr('value',informdate);
                if(registstartdate!=null)
                    $('#registstartdate').attr('value',registstartdate);
                if(registrationdeadline!=null)
                    $('#registenddate').attr('value',registrationdeadline);
                if(enddate!=null)
                    $('#enddate').attr('value',enddate);
                if(data.modelDownloadUrl!=null)
                {
                    
                    let x= data.modelDownloadUrl.split('/');
                    let xlength = x.length;
                    $('#inputfilediv').append('<b>'+x[xlength-1]+'</b>');
                }
                    
            });
        }
        
		function getCookie(c_name)
        {
            //alert(c_name);
            //alert(document.cookie);
			if(document.cookie.length>0){
				c_start=document.cookie.indexOf(c_name+"=");
                if(c_start==-1)
                    return "";
				else if(c_start!=-1){
					c_start=c_start+c_name.length+1;
					c_end=document.cookie.indexOf(";",c_start);
					if(c_end==-1){
						c_end=document.cookie.length;
					}
				}
                return unescape(document.cookie.substring(c_start,c_end));
			}
			return "";
		}
        /*
        function getCookie(cname) 
        { 
            var name = cname + "=";
            var ca = document.cookie.split(';');
            for(var i=0; i<ca.length; i++) 
            {
                var c = ca[i].trim();
                if (c.indexOf(name)==0) 
                    return c.substring(name.length,c.length);
            }
            return "";
        }*/
        function checkCompany()
        {
            var userid = getCookie("userId");
            //var userid = 1;
            //alert("userid"+userid+"  type"+type);
			if(userid=="")
			{
                var b="北京航空航天大学";
                //var b=""
				return b;
			}
			else if(userid!="")
			{
                var c="";
                $.ajaxSettings.async=false;
                    //url=url+"/personal_user";
                $.get(url+"/institution/info?institution_id="+userid,function(data,status){
                    c=data['institutionName'];
                });
                return c;
                
			}
        }
        //检验表单数据
        function upevi(){
            var date1=document.getElementById("startdate").value;
            var date2=document.getElementById("enddate").value;
            var date3=document.getElementById("poststartdate").value;
            var date4=document.getElementById("postenddate").value;
            var date5=document.getElementById("registstartdate").value;
            var date6=document.getElementById("registenddate").value;
            var title=document.getElementById("title").value;
            var address=document.getElementById("address").value;
            var registrationfee=document.getElementById("registrationfee").value;
            var phone=document.getElementById("phone").value;
            var meeting_id;
            /***********************************2018.7.4********************************/
            /***/var date7=document.getElementById("informdate").value;
            /***/var inputfile=document.getElementById("inputfile").value;
            /***/var paperinfo=document.getElementById("paperinfo").value;
            /***/var fileExt=".docx|.doc|.pdf|.rar";
            /***///var extName=inputfile.substring(inputfile.lastIndexof('.')).toLowerCase();
            /***********************************2018.7.4结束*****************************/
            if(date1==""||date2==""||date5==""||date6=="")
            {
                alert("请补全必填项！")
                event.returnValue=false;
            }
            else if(title==""||address==""||registrationfee==""||phone=="")
            {
                alert("请补全必填项！")
                event.returnValue=false;
            }
            else if(date1!=""&&date2!=""&&date1>date2)
            {  
                alert("会议开始时间不能晚于结束时间！")
                event.returnValue=false;
            }
            else if(date3!=""&&date4!=""&&date3>date4)  
            {  
                alert("投稿开始时间不能晚于结束时间！");
                event.returnValue=false;
            }
            else if(date5!=""&&date6!=""&&date5>date6)  
            {  
                alert("注册开始时间不能晚于结束时间！");
                event.returnValue=false;  
            }
            else if(date4!=""&&date5!=""&&date4>date5)  
            {  
                alert("投稿结束时间不能晚于注册开始时间！");
                event.returnValue=false;
            }
            else if(date6!=""&&date1!=""&&date6>date1)
            {
                alert("注册时间不能晚于会议开始时间！");
                event.returnValue=false;
            }
            /***********************************2018.7.4********************************/
            /***/else if(date7!=""&&date4!=""&date4>date7)
            /***/{
            /***/    alert("截稿时间不能晚于审核结果发布时间！");
            /***/    event.returnValue=false;
            /***/}
            /***/else if(date7!=""&&date6!=""&&date7>date6)
            /***/{
            /***/    alert("审核结果发布时间不能晚于注册结束时间！");
            /***/    event.returnValue=false;
            /***/}
            /*else if(inputfile==null||inputfile=="")
            {
                alert("请上传论文模板！");
                event.returnValue=false;
            }              
            else if (inputfile.lastIndexOf('.')==-1){    //如果不存在"."  
                alert("路径不正确!");
                event.returnValue=false;
            }
            else if(fileExt.indexOf(extName+"|")==-1)
            {
                alert("该文件类型不允许上传。请上传 "+fileExt+" 类型的文件，当前文件类型为"+extName);
                event.returnValue=false;
            }       */
            /***********************************2018.7.4结束*****************************/

            else
            {
                //$("#aaa").submit();         
                $("#aaa").ajaxForm(function(data){
                /* if(data==1)alert("注册成功");
                if(data==2)alert("该单位已存在");
                if(data==3)alert("上传审核文件失败");
                if(data==4)alert("用户名已存在");*/
                //alert(data);
                meeting_id=data;
                alert('修改成功!');
              });  
            
            setTimeout( function(){
                
              window.location="conference-main.html?meetingid="+meeting_id;
            }, 3000 );       
            }
        }
        function doPostRegister()
		{
			//alert("qqq");
			var val1 = document.getElementById("username").value;
            var val2 = document.getElementById("password1").value;
            var val3 = document.getElementById("repassword").value;
			var val4 = document.getElementById("useremail").value;
            var val5 = document.getElementById("idnumber").value;
			var user = {
        	"username":val1,
        	"password":val2,
			"email":val4,
            "idnumber":val5
        	};
                   
			user = JSON.stringify(user);
        	var settings = {
			        type: "POST",
			        url:url+"/personal_user",
			        data:user,
			        error: function(XHR,textStatus,errorThrown) {
			            alert("error!");
						alert(errorThrown);
			        },
			        success: function(data,textStatus) {
						if(data==false)
						{
							alert("该昵称已被注册！");
						}
						else
						{
							alert("注册成功！");
							window.location.href='Navigation.html';
							
						}
			        },
			        headers: {
			            "Content-Type":"application/json"
			        }
			        
			};
			
            var isRightForm = true;
			if(val1=="")
			{
				alert("昵称不能为空！");
                isRightForm = false;
			}
			if(val2=="")
			{
				alert("密码不能为空！");
                isRightForm = false;
			}
			if(val2!=val3)
			{
				alert("两次输入密码不相同！");
                isRightForm = false;
			}
			if(val4=="")
			{
				alert("邮箱不能为空！");
                isRightForm = false;
			}
            
            /*判断输入身份证号是否合法 */
            /*简单判断是否为18位数字 */
            /*
            if(val5.length!=18){ 
                isRightForm = false; 
            }
            if(!isNumber(val5)){ 
                isRightForm = false;
            }*/
            
            var reg1 = /^(\d{15}|\d{18})$/;
            if(!reg1.test(val5)){
                alert("身份证号输入错误！");
                isRightForm = false;
            }
            /*判断邮箱是否格式正确 */
            var reg2 = new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$"); //正则表达式
            if(!reg2.test(val4)){
                alert("邮箱格式输入错误！");
                isRightForm = false;
            }
            if(isRightForm){
                $.ajax(settings);
            }
		}
		function doPostLogin()
		{
			//alert("qqq");
			var val1 = document.getElementById("email_username").value;
            var val2 = document.getElementById("password").value;
            var type = $('#option input:radio:checked').val();
            document.cookie = "type="+type;
            //alert(document.cookie);
            if(type=="user_option"){
                $.get(url+"/personal_user?email="+val1+"&password="+val2,function(data)
                {
                    if(data==0)
                    {
                        alert("用户名或密码不正确！");
                    }
                    else
                    {
                        //alert(document.cookie);
                        document.cookie = "userId="+data;
                        alert("登录成功！");
                        window.location.href="createmeetings.html";
                    }
                });	
            }
            else if(type=="institution_option"){
                $.get(url+"/institution/login?username="+val1+"&password="+val2,function(data)
                {
                    if(data==0)
                    {
                        alert("用户名或密码不正确！");
                    }
                    else
                    {
                        document.cookie = "userId="+data;
                        alert("登录成功！");
                        //window.location.href="Navigation.html";
                        window.location.href="createmeetings.html";
                    }
                });	
            }
		}
		function logout() 
		{
   		    setCookie("userId", "", -1);
            setCookie("type","",-1)
		    location.reload();
		}
        
		function checkName()
        {
            var type = getCookie("type");
			var userid = getCookie("userId");
            //alert("userid"+userid+"  type"+type);
			if(userid=="")
			{
                var b="游客";
				return b;
			}
			else if(userid!="")
			{
                if(type=="user_option"){
                    document.getElementById("SignIn").href="#";
                    document.getElementById("LogIn").onclick=null;
                    var c="";
                    $.ajaxSettings.async=false;
                    //url=url+"/personal_user";
                    $.get(url+"/personal_user/info?uid="+userid,function(data,status){
                        c=data['username'];
                    });
                    return c;
                }
                else if(type=="institution_option"){
                    document.getElementById("SignIn").href="#";
                    document.getElementById("LogIn").onclick=null;
                    var c="";
                    $.ajaxSettings.async=false;
                    //url=url+"/personal_user";
                    $.get(url+"/institution/info?institution_id="+userid,function(data,status){
                        c=data['institutionName'];
                    });
                    return c;
                }
                
			}
		}
        function setCookie(cname, cvalue, exdays)
        {
		    var d = new Date();
		    d.setTime(d.getTime() + (exdays*24*60*60*1000));
		    var expires = "expires="+d.toUTCString();
		    document.cookie = cname + "=" + cvalue + "; " + expires;
	    }
        function userLogin()
        {
            $('#userLogin').modal();
        }
        function userRegister()
        {
            $('#userRegister').modal();
        }
        function createMeeting()
        {
            var type = getCookie("type");
			var userid = getCookie("userId");
            if(type=="institution_option"&&userid!=""){
                window.location.href="conference/createmeetings.html";
            }
        }
    </script>
    
</html>
